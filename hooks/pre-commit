#!/bin/sh
# Pre-commit: escanea secretos antes de crear el commit.
# Uso: copiar/symlink a .git/hooks/pre-commit (dar permisos de ejecución)
REPO_ROOT=$(git rev-parse --show-toplevel 2>/dev/null)
if [ -z "$REPO_ROOT" ]; then
  echo "No es un repo git"
  exit 0
fi

echo "[pre-commit] Escaneando secretos..."
python3 "$REPO_ROOT/secretscan.py" scan "$REPO_ROOT"
STATUS=$?
if [ $STATUS -ne 0 ]; then
  echo ""
  echo "❌ Se detectaron posibles secretos no ignorados."
  echo "   - Revisa la tabla anterior."
  echo "   - Si confirmas un falso positivo, añade su fingerprint:"
  echo "       python3 secretscan.py ignore <fingerprint>"
  echo "   - Después vuelve a intentar el commit."
  exit 1
fi
echo "✅ Sin secretos nuevos. Continuando con el commit."
exit 0
